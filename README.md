# 比特币定投收益演示网站说明

## 项目概览
- 这是一个静态网站，用于展示在指定时间范围内的比特币定投（DCA）收益表现。
- 支持两类定投模式：
  - 每月固定日期（1–31）。若当月没有该日期，则使用当月最后一天。
  - 按 AHR999 指数阈值买入。可选阈值：`0.5/0.6/0.7/0.8/0.9/1.0/1.1/1.2`。
- 在 AHR999 模式下，还支持“投资频率”：
  - 满足阈值的所有日期（每日筛选）。
  - 每月仅一次（若该月没有任何达标日，则回退到当月最后一天买入），从而让投资次数与“按月”模式一致。
- 页面展示：总投入、期末资产价值、收益与回报率、持币数量、买入次数；并提供资产价值与累计投入的对比折线图。鼠标悬浮显示当日价格与 AHR999 指数。

## 数据参考
- 价格数据文件：`btc-price 2025 ahr999.csv`（路径中包含空格，静态引用时已用 URL 编码）。
- 数据覆盖：2024-01-01 至 2025-11-15（网站展示范围固定为 2024-11-15 至 2025-11-15）。
- CSV 格式：
  - 表头：`date,btc price`
  - 日期格式：`YYYY/M/D`（如 `2025/11/15`）。
  - 价格单位：美元（USD）。

## 投资逻辑
- 时间范围固定：`2024-11-15` 到 `2025-11-15`。
- 每次定投金额：用户可自定义，默认 `100 USD`。
- 每月固定日模式：
  - 对区间内每个自然月，选择用户设定的日期；若当月没有该日期（例如 2/30），则使用该月最后一天。
  - 只有该日有价格记录才会执行买入（数据缺失的日期会跳过）。
- AHR999 阈值模式：
  - 当日 `AHR999 ≤ 阈值` 时买入。
  - 投资频率：
    - “满足阈值的所有日期”：区间内所有达标的日期均买入。
    - “每月仅一次”：逐月选择第一个达标日买入；若该月没有达标日，则回退到该月最后一天买入（该日需有价格记录）。
- 统计指标：
  - 累计投入 = 买入次数 × 每次定投金额。
  - 持币数量 = Σ(每次买入的金额 / 当日价格)。
  - 期末资产价值 = 持币数量 × `2025-11-15` 的价格。
  - 收益 = 期末资产价值 − 累计投入；回报率 = 收益 / 累计投入。

## AHR999 指数算法说明
- AHR999 的定义：
  - `AHR999 = (价格 / 200日定投成本) × (价格 / 指数增长估值)`
- 200 日定投成本（等额美元买入的 200 天平均成本）：
  - 若过去 200 天的每日价格分别为 `p1, p2, ..., p200`，在每天用同样的美元金额买入时，累计持币数约为 `Σ(1/pi)`（以金额为 1 计算的相对买入量）。
  - 对应的平均每枚成本 `C = 200 / Σ(1/pi)`。
  - 实现中采用滚动计算：自数据开始处累积 `1/price` 的和，跨过 200 天后对窗口进行减法更新；从第 200 天开始输出成本。
- 指数增长估值（反映随币龄增长的估值基线）：
  - `指数增长估值 = 10^(5.84 × log10(币龄) − 17.01)`
  - 币龄（天）= 当前日期距离创世日 `2009-01-03` 的天数。
  - 实现中使用 UTC 日期差并加 1，保证创世日当天币龄为 1，避免对数计算异常。
- 综合：当价格远低于“200日定投成本”和“指数增长估值”时，`AHR999` 数值更低；设定阈值（例如 0.7）可作为择时信号。

## 计算实现细节
- 数据解析与范围过滤：
  - 解析 CSV 后按日期排序；只使用 `2024-11-15` 到 `2025-11-15` 的记录作展示与回测。
- 月度买入日期选择：
  - 构造目标日 `YYYY-MM-(用户设定日)`，若该月没有该日，则以该月最后一天替代；该日必须存在价格记录才视为一次买入。
- AHR999 日度筛选：
  - 预先计算每个日期的 `AHR999`，并存入映射；判断是否 `≤ 阈值` 来决定是否买入。
- AHR999 每月仅一次：
  - 对每个自然月，扫描该月的日期，取第一个 `AHR999 ≤ 阈值` 的日期买入；若未找到，则回退到该月最后一天（需有价格记录）。
- 指标与图表：
  - 按每日计算累计投入与持仓价值，渲染“资产价值 vs 累计投入”折线图。
  - 悬浮提示展示当日价格与 AHR999 指数，便于横向滑动比对。

## 使用方法
- 本地预览：
  - 在项目根目录运行：`python3 -m http.server 8000`
  - 打开浏览器访问：`http://localhost:8000/`
- 页面操作：
  - 设置“每次定投金额（USD）”。
  - 选择模式：`每月固定日` 或 `按 AHR999 阈值`。
  - 若选择 `每月固定日`，通过滑块设置日期（1–31）。
  - 若选择 `按 AHR999 阈值`，选择阈值以及“投资频率”（每日达标或每月仅一次）。
  - 点击“计算并更新”，即可刷新指标与图表。

## 部署到 Cloudflare Pages
- 将当前项目推送到 GitHub 仓库（保持 `index.html` 在仓库根目录）。
- 在 Cloudflare Pages 中创建新项目并绑定该仓库：
  - 框架预设：选择“无构建”（静态站点）。
  - 构建设置：保持默认或关闭构建命令；输出目录为仓库根目录。
- 注意事项：
  - CSV 文件名含空格，已在代码中采用 URL 编码路径 `btc-price%202025%20ahr999.csv`；若希望更简洁，可重命名为无空格文件，并同步更新 `app.js` 中的 `csvPath`。

## 目录结构
- `index.html`：页面结构、控件与图表容器。
- `styles.css`：品牌样式与主题布局；颜色、圆角、阴影与动效。
- `app.js`：数据解析、AHR999 计算、定投策略与图表渲染。
- `btc-price 2025 ahr999.csv`：每日价格数据源。
- `README.md`：项目说明文档（本文件）。

## 设计规范（摘要）
- 品牌配色：
  - `primary #1A1A1A`、`accent #FF9900`、`background #FAFAFA`、`text #222222`、`border #E0E0E0`
- 风格：浅色极简、单列居中、充足留白。
- 圆角：≤ 16px；阴影：轻柔扩散型，透明度约 10–15%。
- 交互与动效：橙色 hover/focus；动画节奏 150–250ms；图表响应式自适应高度。

## 常见问题
- 为什么 AHR999 在前 200 天没有数值？
  - 因为 200 日定投成本需要至少 200 天的窗口才能计算；实现中从第 200 天开始输出该值。
- 数据中的日期与网站的日期格式不一致会怎样？
  - 解析逻辑依赖 `YYYY/M/D` 与 UTC；若格式发生变化需同步更新解析函数。
- 月度模式为何有时买入次数少于自然月数？
  - 若某月目标日或回退日没有价格数据，则会跳过该次买入，以确保数据一致性。

## 扩展方向
- 在图表上直观标记每次买入点（圆点或垂直线）。
- 支持多阈值或多日期的并列比较视图。
- 增加导出功能（CSV/JSON）以便复盘与外部分析。
- 允许用户自定义展示时间范围并进行区间对比。

---
如需进一步定制策略或展示效果（标注买入点、叠加 AHR999 曲线等），可以继续提出需求，我会基于现有实现完善功能。